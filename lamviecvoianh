from PIL import Image, ImageEnhance
import numpy as np
import matplotlib.pyplot as plt
import cv2

anh = Image.open("C:/Users/IT SUPPORTER/Downloads/a2.jpg")

plt.imshow(anh)
plt.title("Ảnh gốc")
plt.show()

# Chuyển đổi hình ảnh sang ảnh xám
# cmap để chỉ định bảng màu
anh_xam = anh.convert('L')
plt.imshow(anh_xam, cmap='gray')
plt.show()
anh_array = np.array(anh_xam)

# Bài 1: Hiển thị histogram cho ảnh
plt.hist(anh_array.ravel(), bins=256, color='gray', alpha=0.7)
plt.title('Histogram của ảnh')
plt.xlabel('Giá trị pixel')
plt.ylabel('Số lượng pixel')
plt.show()

# Bài 2: Tăng/giảm độ sáng
enhancer = ImageEnhance.Brightness(anh)
anh_sang = enhancer.enhance(4.0)

plt.imshow(anh_sang)
plt.show()

#Bài 3: Tăng giảm độ tương phản
#a. Sử dụng công thức min-max, lmin-lmax (chọn min, max dựa vào lược đồ histogram)

# Tính toán giá trị min và max của ảnh
I_min = np.min(anh_array)
I_max = np.max(anh_array)
l_min = 0
l_max = 255
# ADCT
anh_min_max = ((anh_array - I_min) * (l_max - l_min) / (I_max - I_min)) + l_min

# Chuyển mảng numpy về lại ảnh
anh_tuong_phan_a = Image.fromarray(np.uint8(anh_min_max))

plt.imshow(anh_tuong_phan_a, cmap='gray')
plt.title("Ảnh sau khi điều chỉnh độ tương phản")
plt.axis('off')
plt.show()


#b. Sử dụng công thức từng phần: a,b,g (việc lựa chọn phân chia các đoạn dựa vào lược đồ Histogram
hist, bin_edges = np.histogram(anh_array.flatten(), bins=256, range=(0, 255))

# Xác định các ngưỡng a, b, g dựa vào lược đồ histogram
a = 85
b = 170

# Áp dụng công thức điều chỉnh từng phần cho mỗi đoạn trong histogram
# 1. Phần a (0 -> a)
phan_a = anh_array <= a
anh_array[phan_a] = anh_array[phan_a] * 1.2  # Tăng độ sáng cho phần a

# 2. Phần b (a -> b)
phan_b = (anh_array > a) & (anh_array <= b)
anh_array[phan_b] = anh_array[phan_b] * 1.5  # Tăng độ độ sáng phần b

# 3. Phần g (b -> 255)
phan_g = anh_array > b
anh_array[phan_g] = anh_array[phan_g] * 1.3  # Tăng độ sáng cho phần g

# Giới hạn pixel không vượt quá 255
anh_array = np.clip(anh_array, 0, 255)

# Chuyển mảng numpy về lại ảnh
anh_tuong_phan_b = Image.fromarray(np.uint8(anh_array))

plt.subplot(1, 2, 1)
plt.imshow(anh_xam, cmap='gray')
plt.title("Ảnh gốc")
plt.axis('off')

plt.subplot(1, 2, 2)
plt.imshow(anh_tuong_phan_b, cmap='gray')
plt.title("Ảnh sau khi điều chỉnh")
plt.axis('off')

plt.show()

#Bài 4: Cân bằng histogram
anh_array = np.array(anh_xam)

# Cân bằng histogram cho ảnh
anh_can_bang = cv2.equalizeHist(anh_array)

anh_can_bang1 = Image.fromarray(anh_can_bang)

# Hiển thị ảnh sau khi cân bằng histogram
plt.imshow(anh_can_bang1, cmap='gray')
plt.title("Ảnh sau khi cân bằng histogram")
plt.axis('off')
plt.show()




